<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ML FlashCards</title>
    <style>
      /* General reset for consistent styling */
      body,
      h2,
      h3,
      div,
      ul,
      li,
      a,
      footer {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      body {
        background-color: #f8f9fa;
        color: #333;
        line-height: 1.6;
        font-size: 16px;
        display: flex;
        flex-direction: column;
        height: 100vh; /* Ensure the body fills the screen height */
        font-family: "Times New Roman", Times, serif;
      }

      #root {
        flex: 1; /* Makes #root fill the available space */
        min-width: 50%;
        max-width: 900px;
        margin: 0 auto;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }

      /* Header styling */
      h2 {
        background-color: #007bff;
        color: #fff;
        text-align: center;
        padding: 10px;
        font-size: 1.75rem;
        margin-bottom: 10px;
      }

      /* Top bar styling */
      #topbar {
        display: flex;
        justify-content: space-between;
        padding: 10px 20px;
        background-color: #f1f1f1;
        border-bottom: 1px solid #ddd;
        transition: background-color 0.3s;
      }

      #topbar a {
        color: #007bff;
        text-decoration: none;
        padding: 5px 10px;
        font-size: 1rem;
      }

      #topbar a:hover {
        /* text-decoration: underline; */
        background-color: #dddddd; /* Darker green on hover */
        border-radius: 4px;
      }

      /* Main container */
      #container {
        display: flex;
        flex: 1; /* Allow container to expand */
        gap: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: auto;
      }

      /* List styling */
      #allList {
        flex: 1;
        background-color: #f9f9f9;
        /* border: 1px solid #ddd;
    border-radius: 5px; */
        padding: 10px;
      }

      #allList h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
        color: #555;
      }

      #qlist {
        /* list-style: none; */
        margin:0 0 0 1.25em
      }

      #qlist li {
        margin-bottom: 0px;
      }

      #qlist li a {
        text-decoration: none;
        color: #007bff;
      }

      #qlist li a:hover {
        text-decoration: underline;
      }

      /* Single question and answer section */
      #single {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #fff;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #ques {
        border-bottom: 1px solid black;
        font-weight: bold;
        font-size: 1.4rem;
        margin-bottom: 20px;
      }

      #ans {
        flex:1;
        margin-bottom: 20px;
        color: #555;
        overflow-y: auto; /* Enable scrolling when content overflows */
        font-size: 1rem;
      }

      #navbar {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
      }

      #navbar a {
        text-decoration: none;
        color: #007bff;
        font-weight: bold;
      }

      #navbar a:hover {
        text-decoration: underline;
      }

      /* Footer styling */
      footer {
        font-style: italic;
        text-align: center;
        padding: 10px;
        background-color: #f1f1f1;
        border-top: 1px solid #ddd;
        margin-top: 10px;
        flex-shrink: 0; /* Ensure footer stays at the bottom */
      }

      footer a {
        color: #007bff;
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }
      .hide {
        display: None !important;
      }
    </style>
    <script type="text/javascript">
      window.MathJax = {
        tex: { inlineMath: [["$", "$"]], displayMath: [["$$", "$$"]] },
      };
    </script>
    <script
      type="text/javascript"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
  </head>
  <body>
    <div id="root">
      <h2>ML FlashCards</h2>
      <div id="topbar">
        <div>
          <a href="#" id="hLink">Full List</a>
        </div>
        <div>
          <a href="#" id="rLink">Random</a>
        </div>
      </div>
      <div id="container">
        <div id="allList">
          <div>
            <h3>List of Questions</h3>
          </div>
          <ul id="qlist"></ul>
        </div>
        <div id="single">
          <div id="ques"></div>
          <div id="ans"></div>
          <div id="navbar">
            <div>
              <a href="#" id="prev" title="Click here or press left nav key"
                >Prev</a
              >
            </div>
            <div>
              <a href="#" id="next" title="Click here or press right nav key"
                >Next</a
              >
            </div>
          </div>
        </div>
      </div>
      <footer>
        Found an issue or want to contribute, visit

        <a href="https://github.com/Koushikphy/ML-FlashCards">
          <object data="./assets/github.svg"></object>/ML-FlashCards</a
        >
      </footer>
    </div>

    <script>
      // or get these from a master json
      // const root = "https://koushikphy.github.io/ML-FlashCards/";
      // const root = "http://127.0.0.1:8000/"
      const root = "http://192.168.23.72:8000/"
      var allData,
        startX = 0,
        endX = 0;
      const allList = document.getElementById("allList");
      const single = document.getElementById("single");
      const ques = document.getElementById("ques");
      const ans = document.getElementById("ans");
      const prev = document.getElementById("prev");
      const next = document.getElementById("next");

      document.getElementById("hLink").setAttribute("href", root);
      document
        .getElementById("rLink")
        .setAttribute("href", `${root}/?file=random`);


      document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowRight") {
          // Right arrow key
          next.click();
        } else if (event.key === "ArrowLeft") {
          // Right arrow key
          prev.click();
        }
      });

      document.addEventListener("touchstart", (event) => {
        startX = event.touches[0].clientX;
      });

      document.addEventListener("touchend", (event) => {
        event.preventDefault(); 
        endX = event.changedTouches[0].clientX;
        if (startX < endX - 50) {
          // Swipe left (threshold: 50px)
          prev.click();
        } else if (startX > endX + 50) {
          // Swipe right (threshold: 50px)
          next.click();
        }
      });

      function fetchCall(url) {
        return fetch(url).then((response) => {
          if (!response.ok) {
            throw new Error(`Failed to fetch ${url}: ${response.statusText}`);
          }
          return response.json();
        });
      }

      async function fetchData(fileName) {
        let jsonFilePath;

        // Check if the fileName is "random"
        if (fileName == "random") {
          try {
            const data = await fetchCall(`${root}/jsons/full.json`);
            const randomIndex = Math.floor(Math.random() * data.length); // Generate a random index
            jsonFilePath = `${root}/jsons/${data[randomIndex].file}.json`;
          } catch (error) {
            console.error("Error:", error.message);
            return;
          }
        } else {
          jsonFilePath = `${root}/jsons/${fileName}.json`;
        }

        // Fetch the JSON file
        try {
          const info = await fetchCall(jsonFilePath);
          // Assuming `ques` and `ans` are DOM elements
          ques.innerHTML = info["question"].replace(/\\\\/g, "\\");
          ans.innerHTML = info["answer"].replace(/\\\\/g, "\\");
          // console.log(info);
          prev.setAttribute("href", `${root}/?file=${info["prev"]}`);
          next.setAttribute("href", `${root}/?file=${info["next"]}`);
          // prev.href = `/?file=${info["prev"]}`
          // next.next = `/?file=${info["next"]}`
          MathJax.typesetPromise([ques, ans]).catch((err) =>
            console.error("MathJax rendering failed: ", err)
          );
        } catch (error) {
          console.error("Error:", error.message);
        }
      }


      const urlParams = new URLSearchParams(window.location.search);
      const fileName = urlParams.get("file");

      if (fileName) {
        allList.classList.add("hide");
        single.classList.remove("hide");
        fetchData(fileName);
      } else {
        allList.classList.remove("hide");
        single.classList.add("hide");

        fetchCall(`${root}/jsons/full.json`).then((data) => {
          document.getElementById("qlist").innerHTML = data
            .map(
              (elem) =>
                `<li><a href="?file=${elem.file}">${elem.question}</a></li>`
            )
            .join("\n");
        });
      }
    </script>
  </body>
</html>
