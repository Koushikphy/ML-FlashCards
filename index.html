<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ML FlashCards</title>
    <style>
      body,
      h2,
      h3,
      div,
      ul,
      li,
      a,
      footer {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      body {
        background-color: #f8f9fa;
        color: #333;
        line-height: 1.6;
        font-size: 16px;
        display: flex;
        flex-direction: column;
        height: 100dvh; /*Dynamic Viewport Height*/
        font-family: "Times New Roman", Times, serif;
        padding: 0 9px;
      }


      #root {
        flex: 1; 
        width: 800px;
        max-width: 100%;
        margin: 0 auto;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }


      #banner {
        background-color: #007bff;
        color: #fff;
        text-align: center;
        padding: 0.5em;
        height: 5em;
      }
      #brand {
        color: black;
        text-align: right;
        font-style: italic;
        font-size: 0.9em;
        margin: 0;
        padding: 0;
        line-height: 0.9em;
      }

      #topbar {
        display: flex;
        justify-content: space-between;
        padding: 10px 20px;
        background-color: #f1f1f1;
        border-bottom: 1px solid #ddd;
        transition: background-color 0.3s;
      }

      #topbar a {
        color: #007bff;
        text-decoration: none;
        padding: 5px 10px;
        font-size: 1rem;
      }

      #topbar a:hover {
        background-color: #dddddd; 
        border-radius: 4px;
      }

      #container {
        display: flex;
        flex: 1;
        gap: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: auto;
      }

      #allList {
        flex: 1;
        background-color: #f9f9f9;
        padding: 10px;
      }

      #allList h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
        color: #555;
      }

      #qlist {
        margin: 0 0 0 1.25em;
      }

      #qlist li {
        margin-bottom: 0px;
      }

      #qlist li a {
        text-decoration: none;
        color: #007bff;
      }

      #qlist li a:hover {
        text-decoration: underline;
      }

      #single {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #fff;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #ques {
        border-bottom: 1px solid black;
        font-weight: bold;
        font-size: 1.25em;
        margin-bottom: 1em;
        min-height: 3em;
      }

      #ans {
        flex: 1;
        margin-bottom: 20px;
        color: #555;
        overflow-y: auto; 
        font-size: 1rem;
      }

      #navbar {
        display: flex;
        justify-content: space-between;
        margin-top: 1em;
      }

      #navbar a {
        text-decoration: none;
        color: #007bff;
        font-weight: bold;
      }

      #navbar a:hover {
        text-decoration: underline;
      }

      .hide {
        display: None !important;
      }
      
    </style>
    <script type="text/javascript">
      window.MathJax = {
        tex: { inlineMath: [["$", "$"]], displayMath: [["$$", "$$"]] },
      };
    </script>
    <script
      type="text/javascript"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
  </head>
  <body>

    <div id="root">
      <div id="banner">
        <h2>ML FlashCards</h2>
        <div id="brand">
          <a href="https://github.com/Koushikphy/ML-FlashCards">Follow on</a>
          <svg  xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 16 16" width="16" height="16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
          </svg>
        </div>
      </div>
      <div id="topbar">
        <div>
          <a href="#" id="hLink">Full List</a>
        </div>
        <div>
          <a href="#" id="rLink">Random</a>
        </div>
      </div>
      <div id="container">
        <div id="allList">
          <div>
            <h3>List of Questions</h3>
          </div>
          <ul id="qlist"></ul>
        </div>
        <div id="single">
          <div id="ques"></div>
          <div id="ans"></div>
          <div id="navbar">
            <div>
              <a href="#" id="prev" title="Click here or press left nav key"
                >Prev</a
              >
            </div>
            <div>
              <a href="#" id="next" title="Click here or press right nav key"
                >Next</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // or get these from a master json

      const allList = document.getElementById("allList");
      const single = document.getElementById("single");
      const ques = document.getElementById("ques");
      const ans = document.getElementById("ans");
      const prev = document.getElementById("prev");
      const next = document.getElementById("next");
      const root = window.location.origin + window.location.pathname.replace(/\/+$/, '');
      const urlParams = new URLSearchParams(window.location.search);
      var allData,
        startX = 0,
        endX = 0;

      document.getElementById("hLink").setAttribute("href", root);
      document
        .getElementById("rLink")
        .setAttribute("href", `${root}/?file=random`);

      // Event listners for left/right navigation keys
      document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowRight") {
          next.click();
        } else if (event.key === "ArrowLeft") {
          prev.click();
        }
      });

      // Event listners for left/right swiping
      document.addEventListener("touchstart", (event) => {
        startX = event.touches[0].clientX;
      });

      document.addEventListener("touchend", (event) => {
        endX = event.changedTouches[0].clientX;
        if (startX < endX - 50) {
          prev.click();
        } else if (startX > endX + 50) {
          next.click();
        }
      });

      function fetchCall(url) {
        return fetch(url).then((response) => {
          if (!response.ok) {
            throw new Error(`Failed to fetch ${url}: ${response.statusText}`);
          }
          return response.json();
        });
      }

      async function fetchData(fileName) {
        let jsonFilePath;

        if (fileName == "random") {
          try { // fetch full list and randomly choose a single one
            let data = await fetchCall(`${root}/jsons/full.json`);
            let randomIndex = Math.floor(Math.random() * data.length); // Generate a random index
            jsonFilePath = `${root}/jsons/${data[randomIndex].file}.json`;
          } catch (error) {
            console.error("Error:", error.message);
            return;
          }
        } else {
          jsonFilePath = `${root}/jsons/${fileName}.json`;
        }
        // Now fetch a particular question-answer
        try {
          let info = await fetchCall(jsonFilePath);
          ques.innerHTML = info["question"].replace(/\\\\/g, "\\");
          ans.innerHTML = info["answer"].replace(/\\\\/g, "\\");
          // Latex syntax are modified to double slash during conversion 
          // also json can not store with single slach
          // but mathjax can not render those 
          // so they are modified back to single slash
          prev.setAttribute("href", `${root}/?file=${info["prev"]}`);
          next.setAttribute("href", `${root}/?file=${info["next"]}`);
          MathJax.typesetPromise([ques, ans]).catch((err) =>
            console.error("MathJax rendering failed: ", err)
          );
        } catch (error) {
          console.error("Error:", error.message);
        }
      }

      const fileName = urlParams.get("file");

      if (fileName) { // render a single question-answer
        allList.classList.add("hide");
        single.classList.remove("hide");
        fetchData(fileName);
      } else { // render the full question list
        allList.classList.remove("hide");
        single.classList.add("hide");

        fetchCall(`${root}/jsons/full.json`).then((data) => {
          document.getElementById("qlist").innerHTML = data
            .map(
              (elem) =>
                `<li><a href="?file=${elem.file}">${elem.question}</a></li>`
            )
            .join("\n");
        });
      }
    </script>
  </body>
</html>
